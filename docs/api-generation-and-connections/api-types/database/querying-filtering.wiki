= Querying and Filtering Records =
'''Learn how to query, filter, sort, and paginate database records using DreamFactory's REST API'''

import Tabs from '@theme/Tabs'; import TabItem from '@theme/TabItem';

<span id="querying-and-filtering-records-in-dreamfactory"></span>
= Querying and Filtering Records in DreamFactory =

<span id="quick-reference"></span>
== Quick Reference ==

{| class="wikitable"
|-
! Parameter
! Purpose
! Example
|-
| <code>filter</code>
| Filter records
| <code>filter=(status='active')</code>
|-
| <code>fields</code>
| Select columns
| <code>fields=id,name,email</code>
|-
| <code>limit</code>
| Max records
| <code>limit=10</code>
|-
| <code>offset</code>
| Skip records
| <code>offset=20</code>
|-
| <code>order</code>
| Sort results
| <code>order=name ASC</code>
|-
| <code>include_count</code>
| Get total count
| <code>include_count=true</code>
|-
| <code>ids</code>
| Get by IDs
| <code>ids=1,2,3</code>
|}

<span id="overview"></span>
== Overview ==

DreamFactory provides powerful filtering capabilities for database operations, allowing you to precisely query and manipulate your data through the REST API. This guide will walk you through the basics and advanced features of filtering in DreamFactory.

<span id="basic-usage"></span>
== Basic Usage ==

<span id="endpoint-structure"></span>
=== Endpoint Structure ===

<syntaxhighlight lang="http">GET https://{your-dreamfactory-url}/api/v2/{api_name}/_table/{table_name}?filter={filter_string}</syntaxhighlight>
{| class="wikitable"
|-
! Component
! Description
! Example
|-
| <code>api_name</code>
| Name of your API service
| <code>mysql</code>, <code>postgres</code>
|-
| <code>table_name</code>
| Database table to query
| <code>customers</code>, <code>orders</code>
|-
| <code>filter_string</code>
| URL-encoded filter expression
| <code>(status='active')</code>
|}

Your HTTP client will automatically handle URL encoding of special characters in the filter string.
<span id="quick-examples"></span>
=== Quick Examples ===

<syntaxhighlight lang="http"># Basic filtering
GET /api/v2/db/_table/users?filter=(status='active')

# Multiple conditions
GET /api/v2/db/_table/orders?filter=(status='pending') AND (total>100)

# Pagination and sorting
GET /api/v2/db/_table/products?limit=10&offset=0&order=name ASC</syntaxhighlight>
<span id="filter-syntax"></span>
== Filter Syntax ==

DreamFactory uses SQL-like syntax for filtering. Ensure you are familiar with SQL operators and their usage in DreamFactory.
<span id="logical-operators"></span>
=== Logical Operators ===

{| class="wikitable"
|-
! Operator
! Description
! Example
|-
| <code>AND</code>
| Both conditions must be true
| <code>(status='active') AND (age&gt;21)</code>
|-
| <code>OR</code>
| Either condition must be true
| <code>(status='active') OR (status='pending')</code>
|-
| <code>NOT</code>
| Negates the condition
| <code>NOT(status='deleted')</code>
|}

<span id="comparison-operators"></span>
=== Comparison Operators ===

{| class="wikitable"
|-
! Operator
! Description
! Example
|-
| <code>=</code>, <code>!=</code>
| Equality/Inequality
| <code>(status = 'active')</code>
|-
| <code>&gt;</code>, <code>&gt;=</code>
| Greater than (or equal)
| <code>(age &gt; 21)</code>
|-
| <code>&lt;</code>, <code>&lt;=</code>
| Less than (or equal)
| <code>(price &lt; 100)</code>
|-
| <code>IN</code>
| Match any value in set
| <code>(status IN ('active','pending'))</code>
|-
| <code>LIKE</code>
| Pattern matching
| <code>(email LIKE '%@company.com')</code>
|-
| <code>IS NULL</code>
| Check for null values
| <code>(phone IS NULL)</code>
|-
| Range check
| Value in range
| <code>(age&gt;=18) AND (age&lt;=65)</code>
|}

<span id="string-operations"></span>
=== String Operations ===

{{Note|title=Database Compatibility The <code>CONTAINS</code>, <code>STARTS WITH</code>, and <code>ENDS WITH</code> operators have limited database support. For maximum compatibility across all databases (MySQL, PostgreSQL, SQL Server, etc.), use the <code>LIKE</code> operator with wildcards instead. :::|{| class="wikitable"
|-
! Operator
! Description
! Example
! Recommended Alternative
|-
| <code>CONTAINS</code>
| Contains string
| <code>(description CONTAINS 'important')</code>
| <code>(description LIKE '%important%')</code>
|-
| <code>STARTS WITH</code>
| Begins with string
| <code>(name STARTS WITH 'App')</code>
| <code>(name LIKE 'App%')</code>
|-
| <code>ENDS WITH</code>
| Ends with string
| <code>(file ENDS WITH '.pdf')</code>
| <code>(file LIKE '%.pdf')</code>
|}

<span id="common-filter-examples"></span>
=== Common Filter Examples ===

<syntaxhighlight lang="http"># Name filters
GET /api/v2/db/_table/contacts?filter=(first_name='John') AND (last_name='Smith')
GET /api/v2/db/_table/contacts?filter=(first_name='John') OR (first_name='Jane')
GET /api/v2/db/_table/contacts?filter=first_name!='John'

# Pattern matching
GET /api/v2/db/_table/contacts?filter=first_name like 'J%'
GET /api/v2/db/_table/contacts?filter=email like '%@mycompany.com'

# Numeric comparisons
GET /api/v2/db/_table/users?filter=(age >= 30) AND (age < 40)

# Social media handles
GET /api/v2/db/_table/contacts?filter=(twitter like '%jon%') OR (skype like '%jon%')</syntaxhighlight>
<span id="advanced-features"></span>
== Advanced Features ==

<span id="field-selection-and-metadata"></span>
=== Field Selection and Metadata ===

''Allows you to specify which fields to return in the response, reducing the amount of data transferred and improving performance. You can also include metadata such as record count and schema information.''

<syntaxhighlight lang="http"># Select specific fields
GET /api/v2/db/_table/users?fields=id,name,email

# Include record count
GET /api/v2/db/_table/users?include_count=true

# Include schema information
GET /api/v2/db/_table/users?include_schema=true</syntaxhighlight>
<span id="pagination-and-sorting"></span>
=== Pagination and Sorting ===

''Allows you to control the number of records returned and the order in which they are displayed.''

<syntaxhighlight lang="http"># Paginate results
GET /api/v2/db/_table/users?limit=10&offset=20

# Sort results
GET /api/v2/db/_table/users?order=name ASC

# Group results
GET /api/v2/db/_table/users?group=category</syntaxhighlight>
<span id="related-record-filtering"></span>
=== Related Record Filtering ===

''Allows you to filter records based on values in related tables.''

<syntaxhighlight lang="http"># Filter by related table
GET /api/v2/db/_table/orders?filter=(customer.country='USA')

# Filter with nested conditions
GET /api/v2/db/_table/products?filter=(category.name CONTAINS 'Electronics')</syntaxhighlight>
<span id="aggregate-functions"></span>
=== Aggregate Functions ===

''Allows you to perform calculations on data, such as counting records or calculating averages, directly within the query.''

<syntaxhighlight lang="http"># Count records by status
GET /api/v2/db/_table/orders?group=status&fields=status,COUNT(*)

# Calculate averages
GET /api/v2/db/_table/products?fields=category,AVG(price)</syntaxhighlight>
<span id="parameter-replacement"></span>
=== Parameter Replacement ===

''Allows you to use placeholders for values, which are replaced with actual values at runtime.''

<syntaxhighlight lang="http">GET /api/v2/db/_table/users?filter=status=:status_param

# Request Body
{
    "params": {
        ":status_param": "active"
    }
}</syntaxhighlight>}}tip Security Best Practice Always use parameter replacement to prevent SQL injection attacks. This ensures that user input is safely handled. :::

<span id="batch-operations"></span>
=== Batch Operations ===

''Allows you to handle multiple records in a single call, with options to continue processing after failures or roll back all changes if any operation fails.'' | Parameter | Description | Example | |———–|————-|———| | <code>continue</code> | Continue processing after failures | <code>continue=true</code> | | <code>rollback</code> | Rollback all changes if any operation fails | <code>rollback=true</code> |

<span id="record-identification"></span>
=== Record Identification ===

<syntaxhighlight lang="http"># Get by single ID
GET /api/v2/db/_table/users/123

# Get by multiple IDs
GET /api/v2/db/_table/users?ids=1,2,3

# Get by custom ID field
GET /api/v2/db/_table/users?id_field=email&ids=user@example.com</syntaxhighlight>
<span id="best-practices"></span>
== Best Practices ==

# '''Use Parameters''': Enhance security with parameter replacement
# '''Limit Results''': Always paginate large datasets
# '''Select Fields''': Only request needed fields
# '''URL Encoding''': Properly encode special characters
# '''Error Handling''': Use <code>rollback=true</code> for critical operations
# '''Test Incrementally''': Build complex filters step by step
# '''Wrap Conditions''': Always wrap logical conditions in parentheses
# '''Validate Schema''': Use <code>include_schema=true</code> to verify field names

<span id="troubleshooting"></span>
== Troubleshooting ==

<span id="common-issues"></span>
=== Common Issues ===

* Wrap all logical conditions in parentheses
* Use proper quotes for string values
* Verify field names with <code>include_schema=true</code>
* Test complex filters incrementally

<span id="response-format"></span>
=== Response Format ===

<syntaxhighlight lang="json">{
    "resource": [
        {
            "id": 1,
            "name": "Example"
        }
    ],
    "meta": {
        "count": 1,
        "schema": {
            "name": "table_name",
            "fields": [...]
        }
    }
}</syntaxhighlight>
Date/time formats can be configured globally in your DreamFactory configuration. Detailed documentation is available [[getting-started/dreamfactory-configuration/date-and-time-configuration|here]].

== See also ==
* [[Generating_Database_Backed_Api|Generating a Database-backed API]]
* [[Sql_Server|Microsoft SQL Server]]
* [[Querying_Filtering|Querying and Filtering Records]]

[[Category:Database_Query]]
[[Category:Api_Filtering]]
[[Category:Rest_Api_Query]]
[[Category:API]]
[[Category:Database]]
[[Category:Difficulty_Intermediate]]

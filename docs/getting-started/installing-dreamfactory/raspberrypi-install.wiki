<span id="raspberry-pi-installation"></span>
= Raspberry PI installation =

DreamFactory has been tested for install on Raspberry Pi 4 with 4GB of ram using the Raspberry Pi lite OS 64bit (Bookworm release 12). The install process focuses on an Nginx web server with MySql as the default database (the site is published on port 80 of the localhost). This guide provides instructions for downloading, installing and running the necessary packages to host DreamFactory.

<span id="update-pre-installed-packages"></span>
== Update pre-installed packages ==

<syntaxhighlight lang="bash">sudo apt update
sudo apt upgrade -y</syntaxhighlight>
<span id="install-php-and-dependencies"></span>
== Install PHP and Dependencies ==

First, install the lsb-release package which is needed for PHP installation (likely installed by default):

<syntaxhighlight lang="bash">sudo apt install lsb-release</syntaxhighlight>
Add the PHP repository:

<syntaxhighlight lang="bash">curl https://packages.sury.org/php/apt.gpg | sudo tee /usr/share/keyrings/suryphp-archive-keyring.gpg >/dev/null</syntaxhighlight>
Create the source file:

<syntaxhighlight lang="bash">echo "deb [signed-by=/usr/share/keyrings/suryphp-archive-keyring.gpg] https://packages.sury.org/php/ $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/sury-php.list</syntaxhighlight>
Update the package list:

<syntaxhighlight lang="bash">sudo apt update</syntaxhighlight>
Install required system packages:

<syntaxhighlight lang="bash">sudo apt-get install git curl zip unzip</syntaxhighlight>
Install PHP 8.3 and required extensions:

<syntaxhighlight lang="bash">sudo apt-get install -y php8.3-common \
    php8.3-xml \
    php8.3-cli \
    php8.3-curl \
    php8.3-mysqlnd \
    php8.3-sqlite \
    php8.3-soap \
    php8.3-mbstring \
    php8.3-zip \
    php8.3-bcmath \
    php8.3-dev \
    php8.3-ldap \
    php8.3-pgsql \
    php8.3-interbase \
    php8.3-gd \
    php8.3-sybase</syntaxhighlight>
Install Nginx and PHP-FPM:

<syntaxhighlight lang="bash">sudo apt-get install -y nginx php8.3-fpm</syntaxhighlight>
<span id="configuring-php-fpm"></span>
== Configuring PHP-FPM ==

You will need a text editor for this task. The instructions use Nano which comes installed on RPi.

# Edit the php-fpm php.ini file: <code>bash     sudo nano /etc/php/8.3/fpm/php.ini</code>
# Find the line that reads <code>;cgi.fix_pathinfo=1</code>
# Change it to read <code>cgi.fix_pathinfo=0</code>
# Save and exit (Ctrl+x, Y, Enter)

<span id="installing-additional-dependencies"></span>
== Installing Additional Dependencies ==

Install MongoDB dependencies and extension:

<syntaxhighlight lang="bash">sudo apt-get install php8.3-dev php-pear build-essential libssl-dev libcurl4-openssl-dev pkg-config
sudo pecl install mongodb
sudo sh -c 'echo "extension=mongodb.so" > /etc/php/8.3/mods-available/mongodb.ini'
sudo phpenmod mongodb</syntaxhighlight>
Accept all the defaults for mongodb unless you have specific reasons not to. The defaults are all proven to currently work.

Add MongoDB extension to PHP configuration: 1. Edit the php.ini file: <code>bash     sudo nano /etc/php/8.3/fpm/php.ini</code> 2. Add the line <code>extension=mongodb</code> at the bottom of the file (without a preceding semicolon)

<span id="installing-composer"></span>
== Installing Composer ==

Set up Composer:

<syntaxhighlight lang="bash">cd ~
mkdir bin
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"</syntaxhighlight>
<syntaxhighlight lang="bash">php composer-setup.php --install-dir=/home/<youruserhere>/bin --filename=composer</syntaxhighlight>
After installing Composer, restart your terminal or log out and back in to ensure the changes take effect.

<span id="installing-mariadb"></span>
== Installing MariaDB ==

Install MariaDB server (this will be out default MySQL database):

<syntaxhighlight lang="bash">sudo apt-get install mariadb-server -y</syntaxhighlight>
<span id="configuring-mariadb"></span>
== Configuring MariaDB ==

# Log into MariaDB as root: <code>bash     sudo mysql -uroot</code>
# Set the root password and create the DreamFactory database: <code>sql     ALTER USER 'root'@'localhost' IDENTIFIED BY '&lt;Your password here&gt;';</code> <code>sql     FLUSH PRIVILEGES;</code> <code>sql     CREATE DATABASE dreamfactory;</code> Create a user to interface with the DB (default is dfadmin:dfadmin) and give them appropriate permissions: <code>sql     CREATE USER 'dfadmin'@localhost IDENTIFIED BY 'dfadmin';</code> <code>sql     GRANT ALL PRIVILEGES ON dreamfactory.* TO 'dfadmin'@localhost IDENTIFIED BY 'dfadmin';</code> <code>sql     FLUSH PRIVILEGES;</code> The user you create for the DreamFactory DB will need to be used when setting up DreamFactory, the default is dfadmin:dfadmin

<span id="installing-dreamfactory"></span>
== Installing DreamFactory ==

<ol style="list-style-type: decimal;">
<li><p>Create and set up the DreamFactory directory (change dfuser to your user): <code>bash     sudo mkdir /opt/dreamfactory     sudo chown -R dfuser /opt/dreamfactory</code></p></li>
<li><p>Clone the DreamFactory repository and install dependencies: <code>bash     cd /opt/dreamfactory/     git clone https://github.com/dreamfactorysoftware/dreamfactory.git ./     composer install --no-dev --ignore-platform-reqs</code></p></li>
<li><p>Configure the environment: <code>bash     php artisan df:env</code> If you are following this guide choose option "1" for mysql (mariadb).</p>
[[File:df-installer-database.png|thumb|Default Database Selection]]
<p>Fill in your first and last name, email, phone number and create user login credentials for the Web UI ('''this password must be 16 characters or longer''')</p>
[[File:df-installer-user-creation.png|thumb|WEB Interface User Creation]]</li>
<li><p>Edit the .env file: <code>bash     nano .env</code></p>
<ul>
<li><p>Uncomment (remove the ##) the two lines that read:</p>
<syntaxhighlight lang="bash">
##DB_CHARSET=utf8
##DB_COLLATION=utf8_unicode_ci
</syntaxhighlight></li>
<li><p>Set the following values:</p>
<syntaxhighlight lang="bash">
APP_DEBUG=true
APP_LOG_LEVEL=debug
DF_INSTALL=rpi
</syntaxhighlight></li></ul>
</li>
<li><p>Run the DreamFactory setup: <code>bash     php artisan df:setup</code></p></li>
<li><p>Set proper permissions (change dfuser to your user): <code>bash     sudo chown -R www-data:dfuser storage/ bootstrap/cache/     sudo chmod -R 2775 storage/ bootstrap/cache/</code></p></li>
<li><p>Clear the cache: <code>bash     php artisan cache:clear</code> ## Setting up Nginx Config</p></li></ol>

<syntaxhighlight lang="bash">cd /etc/nginx/sites-available/
sudo cp default default.bak
sudo nano default</syntaxhighlight>
Remove all the contents located in default and replace them with:

<syntaxhighlight lang="nginx"># Default API call rate -> Here is set to 1 per second, and is later defined in the location /api/v2 section
limit_req_zone $binary_remote_addr zone=mylimit:10m rate=1r/s;

server {
    listen 80 default_server;
    listen [::]:80 default_server ipv6only=on;
    root /opt/dreamfactory/public;
    index index.php index.html index.htm;
    
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    
    gzip on;
    gzip_disable "msie6";
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_buffers 16 8k;
    gzip_http_version 1.1;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;

    location = /50x.html {
        root /usr/share/nginx/html;
    }

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.ht {
        deny all;
    }

    location ~ /web.config {
        deny all;
    }

    #By default we will limit login calls here using the limit_req_zone set above. The below will allow 1 per second over a
    # 5 seconds (so 5 in 5 seconds)from a single IP  before returning a 429 too many requests. Adjust as needed.
    location /api/v2/user/session {
        try_files $uri $uri/ /index.php?$args;
        limit_req zone=mylimit burst=5 nodelay;
        limit_req_status 429;
    }

    location /api/v2/system/admin/session {
        try_files $uri $uri/ /index.php?$args;
        limit_req zone=mylimit burst=5 nodelay;
        limit_req_status 429;
    }
}</syntaxhighlight>
Restart Nginx and PHP

<syntaxhighlight lang="bash">sudo systemctl restart nginx php8.3-fpm.service</syntaxhighlight>
<span id="access-your-new-dreamfactory-instance"></span>
== Access your new DreamFactory instance ==

After the services are restarted your web server should be ready to access. Go ahead and in your preferred browser type in the ip address of your Raspberry Pi and you should see the login page of the DreamFactory Web UI. To find your ip address on Raspberry Pi easily type in the command line <code>hostname -I</code>

== See also ==
* [[Getting_Started/Docker_Installation|Docker Installation]]
* [[Getting_Started/Windows_Installation|Windows Installation]]
* [[Getting_Started/Installing_Dreamfactory|Installing DreamFactory]]
* [[Getting_Started/Helm_Installation|helm-installation]]

[[Category:Installation]]
[[Category:Getting_Started]]
